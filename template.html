<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Comprehensive Trading Performance Report</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      background-color: #f4f7f6; 
      color: #333; 
      padding: 20px; 
    }
    h1, h2 { 
      text-align: center; 
      color: #6b9080; 
    }
    table { 
      border-collapse: collapse; 
      width: 90%; 
      margin: 20px auto; 
    }
    th, td { 
      border: 1px solid #ddd; 
      padding: 8px; 
      text-align: center; 
    }
    th { 
      background-color: #8fbcb9; 
      color: white; 
    }
    tr:nth-child(even) { 
      background-color: #f9fbfa; 
    }
    .section { 
      margin: 40px 0; 
    }
    .chart { 
      text-align: center; 
      margin: 10px auto; 
    }
    /* Restore specific sizing for equity and histogram charts */
    .equity-chart img { 
      width: 45%; 
      margin: 10px; 
    }
    /* Feature plots at 100% within their containers */
    .feature-plot img {
      width: 100%; 
      height: auto; 
    }
    footer { 
      text-align: center; 
      margin-top: 40px; 
      font-size: 0.9em; 
      color: #777; 
    }
  </style>
</head>
<body>
  <h1>Comprehensive Trading Performance Report</h1>
  
  <!-- Overall Performance Summary Section -->
  <div class="section" id="performance-metrics">
    <h2>Overall Performance</h2>
    <table>
      <thead>
        <tr>
          <th>Metric</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Total Trades</td>
          <td>{{ Total_Trades }}</td>
        </tr>
        <tr>
          <td>Net Profit ($)</td>
          <td>{{ Net_Profit }}</td>
        </tr>
        <tr>
          <td>Average Trade Return</td>
          <td>{{ Avg_Trade_Return }}</td>
        </tr>
        <tr>
          <td>Win Rate (%)</td>
          <td>{{ Win_Rate }}</td>
        </tr>
        <tr>
          <td>Sharpe Ratio</td>
          <td>{{ Sharpe_Ratio }}</td>
        </tr>
        <tr>
          <td>Adjusted Sortino</td>
          <td>{{ adjusted_sortino }}</td>
        </tr>
        <tr>
          <td>Max Drawdown (%)</td>
          <td>{{ Max_Drawdown }}</td>
        </tr>
        <tr>
          <td>Volatility</td>
          <td>{{ Volatility }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- Weekly Performance Section -->
  <div class="section" id="weekly-performance">
    <h2>Weekly Performance</h2>
    {{ Weekly_Summary | safe }}
  </div>
  
  <!-- Equity Curve and Visualizations Section -->
  <div class="section equity-chart" id="visualizations">
    <h2>Equity & Returns</h2>
    <div class="chart">
      <img src="data:image/png;base64,{{ Equity_Curve }}" alt="Equity Curve">
      <img src="data:image/png;base64,{{ Trade_Return_Histogram }}" alt="Trade Return Histogram">
    </div>
  </div>
  
  <!-- Trade Factor Analysis Section -->
  <div class="section" id="trade-factor-analysis">
    <h2>Trade Factor Analysis</h2>
    
    <!-- Win Rate by Symbol Chart -->
    <div class="chart">
      <img src="data:image/png;base64,{{ Win_Rate_By_Symbol }}" alt="Win Rate by Symbol">
    </div>

    <!-- Existing Nx2 Grid Feature Plots -->
    <table style="width:90%; margin:auto; border:none;">
      {% set features = Feature_Plots.keys() | list %}
      {% for i in range(0, features|length, 2) %}
      <tr>
        <td style="width:50%; padding:10px; border:none; vertical-align:top;">
          <div class="feature-plot chart">
            <img src="data:image/png;base64,{{ Feature_Plots[features[i]] }}" alt="Plot for {{ features[i] }}">
          </div>
        </td>

        {% if i + 1 < features|length %}
        <td style="width:50%; padding:10px; border:none; vertical-align:top;">
          <div class="feature-plot chart">
            <img src="data:image/png;base64,{{ Feature_Plots[features[i + 1]] }}" alt="Plot for {{ features[i + 1] }}">
          </div>
        </td>
        {% else %}
        <td style="width:50%; padding:10px; border:none;"></td>
        {% endif %}
      </tr>
      {% endfor %}
    </table>
  </div>

  
  <!-- Open Positions Section -->
  <div class="section" id="open-positions">
    <h2>Open Positions & Exposure</h2>
    {{ Open_Positions | safe }}
  </div>
  
  <!-- Individual Trades Section -->
  <div class="section" id="individual-trades">
    <h2>Individual Trades</h2>
    {{ Individual_Trades | safe }}
  </div>
  
  <footer>
    <p>Trading Performance Report &copy; 2025 | Generated by {{ System_Name }}</p>
  </footer>
</body>
</html>
